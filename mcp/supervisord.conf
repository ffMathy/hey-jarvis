[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
loglevel=info

[program:ollama]
command=ollama serve
directory=/workspace
environment=OLLAMA_HOST="0.0.0.0",OLLAMA_MODELS="/workspace/.ollama/models"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
startretries=3
priority=1

[program:ollama-model-pull]
command=/bin/bash /workspace/mcp/lib/pull-ollama-models.sh
directory=/workspace
environment=OLLAMA_HOST="localhost",OLLAMA_PORT="11434"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=false
startsecs=0
startretries=5
priority=2

[program:mastra-dev]
# DISABLED: mastra dev is currently broken due to a bug in mastra@1.0.0-beta.4
# The bundler incorrectly transforms '@mastra/core/evals' to '@mastra/core/eval' (singular)
# causing "Cannot find module @mastra/core/eval" errors.
# Re-enable once a fixed version of mastra is released.
# The MCP server functionality works without the Studio UI.
command=/bin/true
directory=/workspace
autostart=false
autorestart=false
priority=3

[program:mcp-server]
command=bun run mcp/mastra/mcp-server.ts
directory=/workspace
environment=PORT="%(ENV_MCP_SERVER_PORT)s",HOST="0.0.0.0"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
startretries=3
priority=4
